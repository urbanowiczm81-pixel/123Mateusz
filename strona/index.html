<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Loteria</title>
<style>
:root{
  --bg:#C0C0C0; --text:#222; --card:#fff; --accent:#6a0dad;
}
[data-theme="dark"]{
  --bg:#111; --text:#eee; --card:#222; --accent:#9b59ff;
}
body{font-family:Arial,sans-serif;margin:0;padding:20px;background:var(--bg);color:var(--text);}
header, main, footer{max-width:1000px;margin:0 auto;}
.topbar{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:12px;}
.btn{padding:8px 12px;border-radius:6px;border:0;cursor:pointer;background:var(--accent);color:#fff;}
.btn.gray{background:#999;}
.btn.like{background:#e67e22;}
.muted{color:#666;}
.card{background:var(--card);padding:12px;border-radius:10px;margin-bottom:12px;}
.comment{border-bottom:1px solid #ddd;padding:8px 0;position:relative;display:flex;align-items:flex-start;gap:8px;}
.comment .meta{font-size:0.85em;color:#555;margin-bottom:4px;}
.comment .actions{display:flex;gap:4px;margin-top:4px;}
.comment .actions button{font-size:0.75em;padding:2px 6px;border:none;border-radius:4px;cursor:pointer;}
.avatar{width:40px;height:40px;border-radius:50%;object-fit:cover;border:2px solid rgba(0,0,0,0.08);}
.flex{display:flex;align-items:center;}
.toast{position:fixed;right:20px;bottom:20px;background:#333;color:#fff;padding:10px 16px;border-radius:8px;opacity:0;transform:translateY(20px);transition:all .25s;}
.toast.show{opacity:1;transform:translateY(0);}
.dark-toggle{background:transparent;border:1px solid rgba(0,0,0,0.1);padding:6px;border-radius:6px;}
input, textarea{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:1px solid #ccc;background:#fff;color:#000;}
.small{font-size:0.9em;}
table{width:100%;border-collapse:collapse;margin-top:8px;}
th,td{border:1px solid #999;padding:6px;text-align:left;background:#fff;}
th{background:#ddd;}
@media(max-width:600px){body{padding:12px;}}
#modal{display:none;position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:1000;}
#modal > div{background:var(--card);padding:20px;border-radius:10px;max-width:420px;width:90%;box-shadow:0 0 15px rgba(0,0,0,0.3);}
#modal input,#modal button{border:none;outline:none;border-radius:6px;padding:8px;}
#modal input{background:#f0f0f0;color:#000;margin-bottom:8px;}
#modal button{background:var(--accent);color:#fff;cursor:pointer;}
[data-theme="dark"] #modal input{background:#333;color:#eee;}
[data-theme="dark"] #modal button{background:var(--accent);color:#fff;}
</style>
</head>
<body data-theme="light">

<header class="topbar">
  <div class="flex">
    <h2 style="margin:0;color:var(--accent)">Loteria</h2>
    <button id="themeBtn" class="dark-toggle" style="margin-left:12px">Tryb ciemny</button>
  </div>
  <div>
    <span id="loginStatus" class="muted">niezalogowany</span>
    <button id="goLogin" class="btn">Zaloguj / Zarejestruj</button>
  </div>
</header>

<main>
<section class="card">
  <div style="background-color:#C0C0C0;padding:8px">
    <h1 style="color:#800080">Wygraj u nas gry, samochody, pieniądze i inne nagrody!!!</h1>
    <p style="font-family:'Courier New', monospace;color:blue;font-size:1.2em;">Oferujemy łatwą wygraną oraz szybkie wysyłki</p>
    <marquee direction=right><b style="color:red;">Brawo użytkowniku, wygrałeś nowego iphona 4s!!!</b></marquee>
    <video width="320" height="240" controls>
      <source src="movie.mp4" type="video/mp4">
    </video>
    <center><img src="https://via.placeholder.com/300x200?text=Telefon" alt="telefon"><br></center>
    <img src="https://via.placeholder.com/300x100?text=Strzałka" width="300" height="100" alt="strzałka"><br>
    <p style="color:green;"><big>Codziennie o 12<sup>25</sup> zaczynamy losowania!!!</big></p>
    <a href="https://fajnekonkursy.pl/loterie/" style="color:yellow;font-size:1.2em;">wejdź na naszą stronę!!!</a><br>
    <center><img src="https://via.placeholder.com/500x500?text=GIF" alt="GIF" width="500" height="500"><br></center>
    <p style="color:white;">Nasze opinie prezentują się następująco:</p>
    <table>
      <tr><th>internauta</th><th>opinia</th><th>kraj</th></tr>
      <tr><td>Małgorzata</td><td>9/10</td><td>Niemcy</td></tr>
      <tr><td>Maria</td><td>8/10</td><td>Czechy</td></tr>
      <tr><th>uczestnik</th><th>prędkość wysyłki nagrody</th><th>kraj</th></tr>
      <tr><td>Michał</td><td>2 dni robocze</td><td>Francja</td></tr>
      <tr><td>Antoni</td><td>3 dni robocze</td><td>Hiszpania</td></tr>
    </table>
    <img src="https://via.placeholder.com/300x200?text=Mery_Christmas" alt="Mery_christmas"><br>
    <audio controls autoplay>
      <source src="9.mp3" type="audio/mpeg">
    </audio><br>
    <small>Uwaga inwestowanie może nie być dla ciebie odpowiednie... <a href="https://www.plus500.com/pl/">więcej</a></small><br>
    <b style="color:white;">Pamiętaj Polaku bądź sobą!!!</b>
  </div>
</section>

<section class="card">
  <h3>Formularz kontaktowy</h3>
  <input id="contactName" placeholder="Imię (opcjonalnie)">
  <input id="contactEmail" placeholder="Email">
  <textarea id="contactMsg" placeholder="Wiadomość"></textarea>
  <button id="sendContact" class="btn">Wyślij wiadomość</button>
  <div id="contactStatus" class="small muted"></div>
</section>

<hr>

<section class="card">
  <h3>Komentarze</h3>
  <div id="userPanel" class="small muted">Zaloguj, żeby pisać komentarze i wrzucić awatar.
    <div id="eggCounter" style="margin-top:4px; display:none;">Znalazłeś <span id="eggCount">0</span> easter eggów!</div>
  </div>
  <div id="compose" style="display:none;margin-top:8px">
    <div class="flex">
      <img id="myAvatarPreview" class="avatar" src="" alt="avatar" style="display:none">
      <input type="file" id="avatarUpload" accept="image/*" style="width:auto">
      <div style="flex:1">
        <textarea id="commentText" placeholder="Twój komentarz"></textarea>
        <div class="small muted">Poziom: <span id="userLevel">-</span> • Polubień: <span id="userLikes">0</span></div>
      </div>
    </div>
    <div style="margin-top:8px">
      <button id="postComment" class="btn">Dodaj komentarz</button>
      <button id="clearAvatar" class="btn gray">Usuń awatar</button>
    </div>
  </div>
  <h4 class="small muted" style="margin-top:12px">Na żywo (chat)</h4>
  <div id="commentsList"></div>
</section>

</main>

<div id="toast" class="toast">OK</div>

<div id="modal">
  <div>
    <h3>Zaloguj / Zarejestruj</h3>
    <input id="mEmail" placeholder="E-mail">
    <input id="mPass" placeholder="Hasło" type="password">
    <div style="display:flex;gap:8px;margin-top:8px;">
      <button id="mLogin">Zaloguj</button>
      <button id="mRegister" style="background:#27ae60">Zarejestruj</button>
      <button id="mClose" style="background:#999">Zamknij</button>
    </div>
    <div class="small muted" id="modalMsg"></div>
  </div>
</div>

<footer style="text-align:center;padding:20px" class="small muted">© Twoja Strona</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, doc, setDoc, getDocs, query, orderBy, updateDoc, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC127yAggiPYIHB9X2RV0Ni9Sgx7BW6h8I",
  authDomain: "loteria-8e369.firebaseapp.com",
  projectId: "loteria-8e369",
  storageBucket: "loteria-8e369.appspot.com",
  messagingSenderId: "596116000000",
  appId: "1:596116000000:web:383aa9766aa045a77e77e5",
  measurementId: "G-NTF8HYCZN0"
};
const ADMIN_EMAIL = "urbanowiczm81@gmail.com";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loginStatus = document.getElementById('loginStatus');
const goLogin = document.getElementById('goLogin');
const modal = document.getElementById('modal');
const mClose = document.getElementById('mClose');
const mLogin = document.getElementById('mLogin');
const mRegister = document.getElementById('mRegister');
const mEmail = document.getElementById('mEmail');
const mPass = document.getElementById('mPass');
const modalMsg = document.getElementById('modalMsg');
const themeBtn = document.getElementById('themeBtn');
const body = document.body;

const compose = document.getElementById('compose');
const postComment = document.getElementById('postComment');
const commentText = document.getElementById('commentText');
const commentsList = document.getElementById('commentsList');
const userPanel = document.getElementById('userPanel');

const contactName = document.getElementById('contactName');
const contactEmail = document.getElementById('contactEmail');
const contactMsg = document.getElementById('contactMsg');
const sendContact = document.getElementById('sendContact');
const contactStatus = document.getElementById('contactStatus');

const userLevelEl = document.getElementById('userLevel');
const userLikesEl = document.getElementById('userLikes');

let currentAvatarURL = null;

function toast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2500); }
function formatPL(dateStr){
  const d = new Date(dateStr);
  if(isNaN(d)) return dateStr;
  const months = ["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"];
  return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}, ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
}

// Dark mode
const savedTheme = localStorage.getItem('theme') || 'light';
body.setAttribute('data-theme', savedTheme);
themeBtn.textContent = savedTheme==='light' ? 'Tryb ciemny' : 'Tryb jasny';
themeBtn.addEventListener('click',()=>{
  const cur=body.getAttribute('data-theme');
  const next=cur==='light'?'dark':'light';
  body.setAttribute('data-theme',next);
  localStorage.setItem('theme',next);
  themeBtn.textContent = next==='light'?'Tryb ciemny':'Tryb jasny';
});

// Modal login/register
goLogin.addEventListener('click',()=> modal.style.display='flex');
mClose.addEventListener('click',()=> modal.style.display='none');
mLogin.addEventListener('click',async ()=>{
  modalMsg.textContent='';
  try{
    await signInWithEmailAndPassword(auth,mEmail.value.trim(),mPass.value.trim());
    modal.style.display='none'; toast('Zalogowano');
  }catch(e){ modalMsg.textContent=e.message; }
});
mRegister.addEventListener('click',async ()=>{
  modalMsg.textContent='';
  try{
    await createUserWithEmailAndPassword(auth,mEmail.value.trim(),mPass.value.trim());
    modal.style.display='none'; toast('Zarejestrowano');
  }catch(e){ modalMsg.textContent=e.message; }
});

// Contact form
sendContact.addEventListener('click', async ()=>{
  const name = contactName.value.trim();
  const email = contactEmail.value.trim();
  const msg = contactMsg.value.trim();
  if(!email || !msg){ contactStatus.textContent = 'Email i wiadomość są wymagane!'; return; }
  try{
    await addDoc(collection(db,'contacts'),{name,email,msg,date:new Date()});
    contactStatus.textContent='Wiadomość wysłana!';
    contactName.value=''; contactEmail.value=''; contactMsg.value='';
  }catch(e){ contactStatus.textContent='Błąd wysyłki: '+e.message; }
});

// Comments
postComment.addEventListener('click', async ()=>{
  const user = auth.currentUser;
  if(!user){ toast('Musisz być zalogowany!'); return; }
  const text = commentText.value.trim();
  if(!text) return;
  const commentData = { userId: user.uid, email: user.email, text, date: new Date(), avatar: currentAvatarURL||null, likes: 0 };
  try{ await addDoc(collection(db,'comments'),commentData); commentText.value=''; toast('Komentarz dodany!'); loadComments(); }
  catch(e){ toast('Błąd: '+e.message); }
});

// Load comments
async function loadComments(){
  const user = auth.currentUser;
  commentsList.innerHTML='';
  const q = query(collection(db,'comments'),orderBy('date','desc'));
  const querySnapshot = await getDocs(q);
  querySnapshot.forEach(docSnap=>{
    const c = docSnap.data();
    const div = document.createElement('div');
    div.className='comment';
    const avatarHtml = c.avatar ? `<img src="${c.avatar}" class="avatar">` : '';
    let actionsHtml = '';
    if(user && (user.email===ADMIN_EMAIL || user.uid===c.userId)){
      actionsHtml += `<button class="btn gray" onclick="deleteComment('${docSnap.id}')">Usuń</button>`;
    }
    actionsHtml += `<button class="btn like" onclick="likeComment('${docSnap.id}')">❤ Polub (${c.likes||0})</button>`;
    div.innerHTML = `${avatarHtml}<div><div class="meta">${c.email} • ${formatPL(c.date.toDate?c.date.toDate():c.date)}</div><div>${c.text}</div><div class="actions">${actionsHtml}</div></div>`;
    commentsList.appendChild(div);
  });
}

// Delete & Like
window.deleteComment = async function(commentId){ 
  try{ await deleteDoc(doc(db,'comments',commentId)); toast('Komentarz usunięty!'); loadComments(); } 
  catch(e){ toast('Błąd: '+e.message); } 
}

window.likeComment = async function(commentId){
  const user = auth.currentUser;
  if(!user){ toast('Musisz być zalogowany!'); return; }

  const commentRef = doc(db,'comments',commentId);
  try{
    const commentSnap = await getDoc(commentRef);
    if(!commentSnap.exists()) return;
    const data = commentSnap.data();
    const currentLikes = data.likes || 0;
    await updateDoc(commentRef, { likes: currentLikes + 1 });
    toast('Polubiono komentarz!');
    loadComments();
  }catch(e){ toast('Błąd: '+e.message); }
}

// Auth state
onAuthStateChanged(auth,async (user)=>{
  if(user){
    loginStatus.textContent = user.email+(user.email===ADMIN_EMAIL?' (admin)':'');
    userPanel.textContent = `Jesteś zalogowany jako ${user.email}`;
    compose.style.display='block';
    const userDocSnap = (await getDocs(collection(db,'users'))).docs.find(d=>d.id===user.uid);
    if(userDocSnap){ 
      const ud = userDocSnap.data(); 
      if(ud.avatar){ currentAvatarURL=ud.avatar; document.getElementById('myAvatarPreview').src=currentAvatarURL; document.getElementById('myAvatarPreview').style.display='block'; }
      userLevelEl.textContent=ud.level||'-';
      userLikesEl.textContent=ud.totalLikes||0;
    }else{ 
      userLevelEl.textContent='-'; userLikesEl.textContent='0';
      await setDoc(doc(db,'users',user.uid),{email:user.email},{merge:true});
    }
  }else{
    loginStatus.textContent='niezalogowany';
    userPanel.textContent='Zaloguj, żeby pisać komentarze i wrzucić awatar.';
    compose.style.display='none';
  }
});

// Refresh comments
setInterval(loadComments,5000);
loadComments();
</script>
</body>
</html>
