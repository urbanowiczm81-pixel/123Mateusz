<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Loteria - Pełna wersja</title>
<style>
:root{--bg:#C0C0C0;--text:#222;--card:#fff;--accent:#6a0dad;}
[data-theme="dark"]{--bg:#111;--text:#eee;--card:#222;--accent:#9b59ff;}
body{font-family:Arial,sans-serif;margin:0;padding:20px;background:var(--bg);color:var(--text);}
header, main, footer{max-width:1000px;margin:0 auto;}
.topbar{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:12px;}
.btn{padding:8px 12px;border-radius:6px;border:0;cursor:pointer;background:var(--accent);color:#fff;}
.btn.gray{background:#999;}
.btn.like{background:#e67e22;}
.muted{color:#666;}
.card{background:var(--card);padding:12px;border-radius:10px;margin-bottom:12px;}
.comment{border-bottom:1px solid #ddd;padding:8px 0;position:relative;display:flex;align-items:flex-start;gap:8px;}
.comment .meta{font-size:0.85em;color:#555;margin-bottom:4px;}
.comment .actions{display:flex;gap:4px;margin-top:4px;}
.comment .actions button{font-size:0.75em;padding:2px 6px;border:none;border-radius:4px;cursor:pointer;}
.avatar{width:40px;height:40px;border-radius:50%;object-fit:cover;border:2px solid rgba(0,0,0,0.08);}
.flex{display:flex;align-items:center;}
.toast{position:fixed;right:20px;bottom:20px;background:#333;color:#fff;padding:10px 16px;border-radius:8px;opacity:0;transform:translateY(20px);transition:all .25s;}
.toast.show{opacity:1;transform:translateY(0);}
.dark-toggle{background:transparent;border:1px solid rgba(0,0,0,0.1);padding:6px;border-radius:6px;}
input, textarea{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:1px solid #ccc;background:#fff;color:#000;}
.small{font-size:0.9em;}
table{width:100%;border-collapse:collapse;margin-top:8px;}
th,td{border:1px solid #999;padding:6px;text-align:left;background:#fff;}
th{background:#ddd;}
@media(max-width:600px){body{padding:12px;}}
#modal{display:none;position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:1000;}
#modal > div{background:var(--card);padding:20px;border-radius:10px;max-width:420px;width:90%;box-shadow:0 0 15px rgba(0,0,0,0.3);}
#modal input,#modal button{border:none;outline:none;border-radius:6px;padding:8px;}
#modal input{background:#f0f0f0;color:#000;margin-bottom:8px;}
#modal button{background:var(--accent);color:#fff;cursor:pointer;}
[data-theme="dark"] #modal input{background:#333;color:#eee;}
[data-theme="dark"] #modal button{background:var(--accent);color:#fff;}
#leaderboard{margin-top:12px;border:1px solid #999;padding:10px;border-radius:8px;background:#eee;}
#leaderboard h4{margin:0 0 6px 0;}
</style>
</head>
<body data-theme="light">

<header class="topbar">
  <div class="flex">
    <h2 style="margin:0;color:var(--accent)">Loteria</h2>
    <button id="themeBtn" class="dark-toggle" style="margin-left:12px">Tryb ciemny</button>
  </div>
  <div>
    <span id="loginStatus" class="muted">niezalogowany</span>
    <button id="goLogin" class="btn">Zaloguj / Zarejestruj</button>
  </div>
</header>

<main>
<section class="card">
  <h1>Wygraj u nas gry, samochody i nagrody!</h1>
  <p>Łatwe wygrane i szybka wysyłka. Codziennie losowania o 12:25!</p>
</section>

<section class="card">
  <h3>Formularz kontaktowy</h3>
  <input id="contactName" placeholder="Imię (opcjonalnie)">
  <input id="contactEmail" placeholder="Email">
  <textarea id="contactMsg" placeholder="Wiadomość"></textarea>
  <button id="sendContact" class="btn">Wyślij wiadomość</button>
  <div id="contactStatus" class="small muted"></div>
</section>

<section class="card">
  <h3>Komentarze</h3>
  <div id="userPanel" class="small muted">Zaloguj, żeby pisać komentarze i wrzucać awatar i GIF.
    <div id="eggCounter" style="margin-top:4px; display:none;">Znalazłeś <span id="eggCount">0</span> easter eggów!</div>
  </div>
  <div id="compose" style="display:none;margin-top:8px">
    <div class="flex">
      <img id="myAvatarPreview" class="avatar" src="" alt="avatar" style="display:none">
      <input type="file" id="avatarUpload" accept="image/*" style="width:auto">
      <input type="file" id="mediaUpload" accept="image/*,video/*,gif/*" style="width:auto">
      <div style="flex:1">
        <textarea id="commentText" placeholder="Twój komentarz"></textarea>
        <div class="small muted">Poziom: <span id="userLevel">-</span> • Polubień: <span id="userLikes">0</span></div>
      </div>
    </div>
    <div style="margin-top:8px">
      <button id="postComment" class="btn">Dodaj komentarz</button>
      <button id="clearAvatar" class="btn gray">Usuń awatar</button>
    </div>
  </div>
  <h4 class="small muted" style="margin-top:12px">Leaderboard</h4>
  <div id="leaderboard"></div>
  <h4 class="small muted" style="margin-top:12px">Na żywo (chat)</h4>
  <div id="commentsList"></div>
</section>

</main>

<div id="toast" class="toast">OK</div>

<div id="modal">
  <div>
    <h3>Zaloguj / Zarejestruj</h3>
    <input id="mEmail" placeholder="E-mail">
    <input id="mPass" placeholder="Hasło" type="password">
    <div style="display:flex;gap:8px;margin-top:8px;">
      <button id="mLogin">Zaloguj</button>
      <button id="mRegister" style="background:#27ae60">Zarejestruj</button>
      <button id="mClose" style="background:#999">Zamknij</button>
    </div>
    <div class="small muted" id="modalMsg"></div>
  </div>
</div>

<footer style="text-align:center;padding:20px" class="small muted">© Twoja Strona</footer>

<script type="module">
// ------------------- IMPORTY FIREBASE -------------------
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, doc, setDoc, getDocs, query, orderBy, updateDoc, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "TU_WSTAW_SWÓJ_FIREBASE_API_KEY",
  authDomain: "TU_WSTAW_SWÓJ_FIREBASE_AUTHDOMAIN",
  projectId: "TU_WSTAW_SWÓJ_FIREBASE_PROJECTID",
  storageBucket: "TU_WSTAW_SWÓJ_FIREBASE_STORAGEBUCKET",
  messagingSenderId: "TU_WSTAW_SWÓJ_FIREBASE_MESSAGING",
  appId: "TU_WSTAW_SWÓJ_FIREBASE_APPID"
};

const ADMIN_EMAIL = "urbanowiczm81@gmail.com";
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

// ------------------- FUNKCJE POMOCNICZE -------------------
function toast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2500); }
function formatPL(date){ const d=date instanceof Date?date:date.toDate(); return `${d.getDate()}.${d.getMonth()+1}.${d.getFullYear()} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`; }

// ------------------- ELEMENTY DOM -------------------
const themeBtn=document.getElementById('themeBtn');
const body=document.body;
const goLogin=document.getElementById('goLogin');
const modal=document.getElementById('modal');
const mClose=document.getElementById('mClose');
const mLogin=document.getElementById('mLogin');
const mRegister=document.getElementById('mRegister');
const mEmail=document.getElementById('mEmail');
const mPass=document.getElementById('mPass');
const modalMsg=document.getElementById('modalMsg');
const loginStatus=document.getElementById('loginStatus');

const compose=document.getElementById('compose');
const postComment=document.getElementById('postComment');
const commentText=document.getElementById('commentText');
const commentsList=document.getElementById('commentsList');
const userPanel=document.getElementById('userPanel');
const avatarUpload=document.getElementById('avatarUpload');
const mediaUpload=document.getElementById('mediaUpload');
const myAvatarPreview=document.getElementById('myAvatarPreview');
const clearAvatar=document.getElementById('clearAvatar');
const userLevelEl=document.getElementById('userLevel');
const userLikesEl=document.getElementById('userLikes');
const leaderboardEl=document.getElementById('leaderboard');
const eggCountEl=document.getElementById('eggCount');

// ------------------- DARK MODE -------------------
themeBtn.addEventListener('click',()=>{
  const cur=body.getAttribute('data-theme');
  const next=cur==='light'?'dark':'light';
  body.setAttribute('data-theme',next);
  themeBtn.textContent=next==='light'?'Tryb ciemny':'Tryb jasny';
});

// ------------------- MODAL LOGIN/REGISTER -------------------
goLogin.addEventListener('click',()=>modal.style.display='flex');
mClose.addEventListener('click',()=>modal.style.display='none');
mLogin.addEventListener('click', async()=>{
  try{ await signInWithEmailAndPassword(auth,mEmail.value.trim(),mPass.value.trim()); modal.style.display='none'; toast('Zalogowano'); }catch(e){ modalMsg.textContent=e.message; }
});
mRegister.addEventListener('click', async()=>{
  try{ await createUserWithEmailAndPassword(auth,mEmail.value.trim(),mPass.value.trim()); modal.style.display='none'; toast('Zarejestrowano'); }catch(e){ modalMsg.textContent=e.message; }
});

// ------------------- KOMENTARZE, MEDIA, POLUBIENIA, LEADERBOARD -------------------
let foundEggs=new Set();
const easterEggs=['images/egg1.png','images/egg2.png','images/egg3.png'];

function placeEasterEggs(){
  easterEggs.forEach((src,index)=>{
    const egg=document.createElement('img');
    egg.src=src; egg.style.position='absolute'; egg.style.width='30px';
    egg.style.cursor='pointer'; egg.style.left=Math.random()*(window.innerWidth-40)+'px';
    egg.style.top=Math.random()*(window.innerHeight-40)+'px'; egg.dataset.index=index;
    egg.addEventListener('click', async()=>{
      if(!foundEggs.has(index)){
        foundEggs.add(index);
        toast('Znalazłeś easter egga!');
        const user=auth.currentUser;
        if(user){
          const userRef=doc(db,'users',user.uid);
          const snap=await getDoc(userRef);
          const currentCount=snap.exists()?snap.data().easterEggsFound||0:0;
          await updateDoc(userRef,{easterEggsFound:currentCount+1});
          eggCountEl.textContent=foundEggs.size;
        }
        egg.style.opacity=0.3;
      }
    });
    document.body.appendChild(egg);
  });
}

async function loadComments(){
  const snaps=await getDocs(query(collection(db,'comments'), orderBy('date','desc')));
  commentsList.innerHTML='';
  snaps.forEach(docSnap=>{
    const c=docSnap.data();
    const div=document.createElement('div'); div.className='comment';
    const avatar=document.createElement('img'); avatar.className='avatar'; avatar.src=c.avatar||'https://via.placeholder.com/40';
    const content=document.createElement('div'); content.style.flex='1';
    const meta=document.createElement('div'); meta.className='meta'; meta.textContent=`${c.email} • ${formatPL(c.date)} • Polubień: ${c.likes||0}`;
    const textEl=document.createElement('div'); textEl.textContent=c.text;
    content.appendChild(meta); content.appendChild(textEl);
    if(c.media){ const mediaEl=document.createElement(c.media.endsWith('.mp4')?'video':'img'); mediaEl.src=c.media;
      if(mediaEl.tagName==='VIDEO'){ mediaEl.controls=true; mediaEl.width=200; }else mediaEl.width=200;
      content.appendChild(mediaEl);
    }
    const actions=document.createElement('div'); actions.className='actions';
    const likeBtn=document.createElement('button'); likeBtn.textContent='❤'; likeBtn.className='btn like';
    likeBtn.onclick=()=>likeComment(docSnap.id); actions.appendChild(likeBtn);
    const delBtn=document.createElement('button'); delBtn.textContent='Usuń'; delBtn.className='btn gray';
    delBtn.onclick=()=>deleteComment(docSnap.id,c.userId); actions.appendChild(delBtn);
    content.appendChild(actions); div.appendChild(avatar); div.appendChild(content); commentsList.appendChild(div);
  });
}

async function likeComment(commentId){
  const user=auth.currentUser; if(!user){ toast('Zaloguj się aby polubić komentarz'); return; }
  const commentRef=doc(db,'comments',commentId); const snap=await getDoc(commentRef);
  if(!snap.exists()) return; const data=snap.data();
  await updateDoc(commentRef,{likes:(data.likes||0)+1});
  const authorRef=doc(db,'users',data.userId); const authorSnap=await getDoc(authorRef);
  const authorData=authorSnap.exists()?authorSnap.data():{};
  await updateDoc(authorRef,{totalLikes:(authorData.totalLikes||0)+1});
  toast('Polubiono komentarz!'); loadComments(); updateLeaderboard();
}

async function deleteComment(commentId, commentUserId){
  const user=auth.currentUser; if(!user) return;
  if(user.uid!==commentUserId && user.email!==ADMIN_EMAIL){ toast('Nie możesz usuwać tego komentarza'); return; }
  await deleteDoc(doc(db,'comments',commentId)); toast('Komentarz usunięty'); loadComments(); updateLeaderboard();
}

postComment.addEventListener('click', async()=>{
  const user=auth.currentUser; if(!user){ toast('Zaloguj się aby dodać komentarz'); return; }
  const text=commentText.value.trim(); if(!text && !mediaUpload.files[0]){ toast('Wpisz komentarz lub dodaj media'); return; }
  let mediaURL=null;
  if(mediaUpload.files[0]){ const file=mediaUpload.files[0]; const ref=sRef(storage,`comments/${user.uid}_${Date.now()}_${file.name}`); await uploadBytes(ref,file); mediaURL=await getDownloadURL(ref); }
  await addDoc(collection(db,'comments'),{userId:user.uid,email:user.email,text,media:mediaURL,likes:0,date:new Date(),avatar:myAvatarPreview.src||null});
  commentText.value=''; mediaUpload.value=''; toast('Komentarz dodany!'); loadComments(); updateLeaderboard();
});

// ------------------- LEADERBOARD -------------------
async function updateLeaderboard(){
  const snaps=await getDocs(query(collection(db,'users'), orderBy('totalLikes','desc')));
  leaderboardEl.innerHTML='<h4>Top użytkownicy</h4>';
  snaps.forEach(docSnap=>{
    const u=docSnap.data(); let rank='Nowicjusz';
    if(u.totalLikes>=10) rank='Wygrywający'; if(u.totalLikes>=30) rank='Mistrz losowań';
    const div=document.createElement('div'); div.textContent=`${u.email} • Polubień: ${u.totalLikes} • Ranga: ${rank}`; leaderboardEl.appendChild(div);
    if(auth.currentUser && auth.currentUser.uid===docSnap.id){ userLevelEl.textContent=rank; userLikesEl.textContent=u.totalLikes; }
  });
}

// ------------------- AUTH STATE -------------------
onAuthStateChanged(auth, async(user)=>{
  if(user){
    loginStatus.textContent=user.email+(user.email===ADMIN_EMAIL?' (admin)':'');
    compose.style.display='block';
    userPanel.textContent=`Jesteś zalogowany jako ${user.email}`;
    const userRef=doc(db,'users',user.uid); const snap=await getDoc(userRef);
    if(!snap.exists()) await setDoc(userRef,{email:user.email, totalLikes:0, easterEggsFound:0});
    myAvatarPreview.src=snap.exists()?snap.data().avatar||'':'';
    if(myAvatarPreview.src) myAvatarPreview.style.display='block';
    eggCountEl.textContent=snap.exists()?snap.data().easterEggsFound||0:0;
    foundEggs=new Set();
    placeEasterEggs();
  }else{
    loginStatus.textContent='niezalogowany';
    compose.style.display='none'; myAvatarPreview.style.display='none';
  }
  loadComments(); updateLeaderboard();
});

// ------------------- AVATAR -------------------
avatarUpload.addEventListener('change', async()=>{
  const user=auth.currentUser; if(!user) return;
  const file=avatarUpload.files[0]; if(!file) return;
  const ref=sRef(storage,`avatars/${user.uid}_${Date.now()}_${file.name}`);
  await uploadBytes(ref,file); const url=await getDownloadURL(ref); myAvatarPreview.src=url; myAvatarPreview.style.display='block';
  await updateDoc(doc(db,'users',user.uid),{avatar:url});
});
clearAvatar.addEventListener('click', async()=>{
  const user=auth.currentUser; if(!user) return;
  myAvatarPreview.src=''; myAvatarPreview.style.display='none';
  await updateDoc(doc(db,'users',user.uid),{avatar:null});
});

</script>

</body>
</html>


